services:
  laravel-app:
    build:
      context: ./backend
      dockerfile: Dockerfile.prod
    container_name: shopintelli-api-prod
    environment:
      APP_ENV: production
      APP_DEBUG: "false"
      DB_HOST: mysql
      DB_DATABASE: shopintelli
      DB_USERNAME: user
      DB_PASSWORD: password
      REDIS_HOST: redis
    ports:
      - "8000:8000"
    depends_on:
      - mysql
      - redis
    networks:
      - shopintelli-network

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile.prod
      args:
        VITE_API_URL: http://localhost:8000/api
    container_name: shopintelli-frontend-prod
    ports:
      - "3000:80"
    networks:
      - shopintelli-network

  ai-service:
    build:
      context: ./ai-service
      dockerfile: Dockerfile
    container_name: shopintelli-ai-prod
    environment:
      REDIS_URL: redis://redis:6379
    ports:
      - "8001:8001"
    networks:
      - shopintelli-network

  mysql:
    image: mysql:8.0
    container_name: shopintelli-mysql-prod
    environment:
      MYSQL_DATABASE: shopintelli
      MYSQL_USER: user
      MYSQL_PASSWORD: password
      MYSQL_ROOT_PASSWORD: rootpassword
    volumes:
      - mysql_data_prod:/var/lib/mysql
    ports:
      - "3308:3306"
    networks:
      - shopintelli-network

  redis:
    image: redis:alpine
    container_name: shopintelli-redis-prod
    ports:
      - "6380:6379"
    networks:
      - shopintelli-network

volumes:
  mysql_data_prod:

networks:
  shopintelli-network:
    driver: bridge
